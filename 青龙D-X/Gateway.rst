网络拓扑构成
===================================================================================================

多IP
--------------------------------------------------------------------------------------------
* 域控IP和系统构成,比亚迪只分配一个IP，域控在安全网关D-Link后边，域控有4个子系统；目前SSB用NAT方式为子系统提供服务，效率不高；应该分4个IP，不用转发；
* 不同的命令发到不同的IP地址；
* 1个和4个IP的性能差别, 开发部门需要测试一下需要多少算力；
  


网关芯片
--------------------------------------------------------------------------------------------
* 域控是否需要增加网关芯片；自己加网关芯片，实现高效网络传输，但是硬件改动需要考虑收益；建议不变动；目前方案是做一个软路由，但占用计算资源；
* 域控的基础硬件是星型网络，但是客户需要环形网络；与客户商议合理的网络拓扑；
* 信息安全，每个芯片都要加一个防火墙，如果有网关，就可以在网关布置一个防火墙即可；
* 车载路由的常规方案,是由S32G 搭配SJA1110;整车防火墙在D-Link
* 大域控对外出口,多SOC多子系统,是否需要单独的网关IC


OTA
--------------------------------------------------------------------------------------------
* 客户需求 300秒,当前3G容量大小OTA传输的时间为900秒;
* 要确定最恶劣情况下OTA的传输要求;
* 客户侧不需要整个操作系统升级, 需要APP更新, 且要有给操作系统打补丁的能,以及BSP升级。


信息安全
--------------------------------------------------------------------------------------------


系统以太网通信拓扑
--------------------------------------------------------------------------------------------
ADAS域控外部IP

问题:整个域控中J5、X9U.SSA、X9U.SSB、TC397都有以太网接口,因此都需要内部IP。且J5、X9U.SSA、X9U.SSB、TC397都有对内部和外部网络通信的需求,但域控中没有路由设备，因此，域控内网络拓扑设计如下

#. 在X9U.SSB上,利用NAT模式建立路由器

#. 在X9U.SSB上部署外网IP，J5、X9U.SSA、TC397和J上都需要部署内网IP（X9U.SSB上需要部署内网、外网两个IP）

#. 外网通信的数据首先会送到X9U.SSB（只有这里部署的外网IP），X9U.SSB根据应用的端口号，将数据转发给

.. image:: /images/域控IP.png

网络端口号设计如下

DLink: 192.168.195.2

X9U.SSB 对外:192.168.195.3

        对内:192.168.1.1

ADS域控的MAC、IP配置如下:

#. MAC address (16进制)     => 02:22:23:01:02:03

#. IPv4  address (10进制)   => 192.168.195.3

#. 子网掩码                 => 255.255.255.0

#. 网络地址                 => 192.168.195.0 在与系统工程师确认

#. 默认网关IP               => 192.168.195.1

#. 客户端ID                 => 0x0301

TC397：IP：192.168.1.4

MAC：FE:AA:BB:CC:DD:04

X9U SSA： IP：192.168.1.2

MAC：FE:AA:BB:CC:DD:02

J5： IP：192.168.1.3

MAC：FE:AA:BB:CC:DD:03

※   与客户确认，域控内部MAC地址禁止使用02:22:23:XX:XX:XX地址，其他可以使用


网络拓扑改造方案
-------------------------------------------------------------------------
由于硬件限制，现有网络拓扑并不是很合理。以下给出合理的网络拓扑方案，方案一在硬件可以升级的改造的情况下，推荐使用。方案二域控内部通信更加合理，客户同意情况下可以使用。

网络拓扑修改方案1
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
将网络拓扑修改为以下结构，修改点如下：

#. 原以太网交换机 -> 以太网路由器

#. 外网IP部署到路由器外网端口侧

.. image:: /images/域控IP_1.png

优缺点分析：

优点

#.     网络拓扑更合理，可以降低网络通信带宽

#.     外网 à 内网信息转发由路由实现，降低域控CPU负担

缺点

#.     硬件需要发生变更

#.     路由器侧可能存在软件开发工作量（需要硬件选型后才能明确）

#.     如果客户要求多个外网端口，需要硬件支持（市面常见路由器都是只要一个外网端口，不知道车载路由器芯片情况）

网络拓扑修改方案2
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
将网络拓扑修改为以下结构，修改点如下：

#. 域控内部署4个外网IP，即从外部看来，域控是拥有4个网络地址的设备

#. 域控外的设备需要明确知道，每条通信信息需要发到哪个地址

.. image:: /images/域控IP_2.png

优缺点分析：

优点

#. 域控硬件不需要修改

#. 域控不需要内部设置路由、不需要以太网信息转发，可以降低通信带宽

缺点

#. 需要给域控提供4个IP地址

#. 外部需要能够认识到域控是拥有4个IP地址的设备，且能够对不同命令选择不同IP地址发送，增加外部设备开发工作量
